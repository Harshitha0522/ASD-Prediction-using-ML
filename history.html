<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t('history.title') }} - {{ t('home.title') }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="{{ url_for('home') }}" class="navbar-brand">üß† {{ t('home.title') }}</a>
            <div class="navbar-right">
                <ul class="navbar-nav">
                    <li><a href="{{ url_for('user_info') }}" class="navbar-link">New Test</a></li>
                    <li><a href="{{ url_for('logout') }}" class="navbar-logout">Logout</a></li>
                </ul>

                {% if current_user.is_authenticated %}
                    <div class="navbar-user-dropdown" id="navUserDropdown">
                        <button class="navbar-user-btn">{{ current_user.username }} ‚ñæ</button>
                        <ul class="navbar-user-menu">
                            <li><a href="{{ url_for('user_info') }}">My Profile</a></li>
                            <li><a href="{{ url_for('retraining_monitor') }}">Status</a></li>
                            <li><a href="{{ url_for('history') }}">History</a></li>
                            <li><a href="{{ url_for('logout') }}">Logout</a></li>
                        </ul>
                    </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <main>
        <div class="center-box">
            <h2>{{ t('history.title') }}</h2>
            <p class="text-muted">{{ t('history.description') }}</p>

            {% if responses %}
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ total_responses }}</div>
                        <p class="stat-label">Total Tests</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ avg_score }}%</div>
                        <p class="stat-label">Average Score</p>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ high_scores }}</div>
                        <p class="stat-label">High Risk (‚â•70%)</p>
                    </div>
                </div>

                <div class="responses-table">
                    <table>
                        <thead>
                            <tr>
                                <th>{{ t('history.date') }}</th>
                                <th>Relation</th>
                                <th>{{ t('history.score') }}</th>
                                <th>{{ t('history.status') }}</th>
                                <th>{{ t('history.action') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for response in responses %}
                                <tr>
                                    <td>{{ response.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>{{ response.relation }}</td>
                                    <td class="score-cell">{{ response.score }}%</td>
                                    <td>
                                        {% if response.score >= 70 %}
                                            <span class="badge badge-danger">High</span>
                                        {% elif response.score >= 30 %}
                                            <span class="badge badge-warning">Moderate</span>
                                        {% else %}
                                            <span class="badge badge-success">Low</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('view_response', response_id=response.id) }}" class="btn btn-small btn-primary">View</a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="info-box">
                    <p>You haven't completed any tests yet.</p>
                    <a href="{{ url_for('user_info') }}" class="btn btn-primary">Start New Test</a>
                </div>
            {% endif %}

            <div class="form-actions">
                <a href="{{ url_for('user_info') }}" class="btn btn-secondary">Take Another Test</a>
                <a href="{{ url_for('export_data') }}" class="btn btn-info">üì• Export Data</a>
                <a href="{{ url_for('export_analytics') }}" class="btn btn-info">üìä Export Analytics</a>
                <a href="{{ url_for('export_features') }}" class="btn btn-info">üîç Export Features</a>
                <a href="{{ url_for('ab_test') }}" class="btn btn-info">üìä A/B Test Models</a>
                <a href="{{ url_for('calibration') }}" class="btn btn-warning">üéØ Calibration</a>
                <a href="{{ url_for('retraining_monitor') }}" class="btn btn-success">üîÑ Retraining Monitor</a>
                <a href="{{ url_for('home') }}" class="btn btn-primary">Go Home</a>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 ASD Prediction App. All rights reserved.</p>
    </footer>
</body>
</html>
